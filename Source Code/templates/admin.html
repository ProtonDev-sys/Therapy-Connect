{% extends "sidebar.html" %} {% block content %}
<!DOCTYPE html>
<html>
  <head>
    <title>Admin Panel</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='css/admin.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
    />
  </head>
  <body>
    <nav>
      <a class="active" onclick="showContent('content1', this)"
        >User Accounts</a
      >
      <a onclick="showContent('content2', this)">Action 2</a>
      <a onclick="showContent('content3', this)">Action 3</a>
      <a onclick="showContent('content4', this)">Action 4</a>
      <a class="logout" onclick="logout()">Logout</a>
    </nav>
    <div class="main">
      <div id="content1">
        <input
          type="text"
          id="searchInput"
          placeholder="Search..."
          onkeyup="searchDatabase()"
        />
        <table id="databaseTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Password</th>
              <th>Creation Date</th>
              <th>Permission Level</th>
              <th>Account Type</th>
              <th>Session Token</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Database records will be dynamically added here -->
          </tbody>
        </table>
        <div id="pagination">
          <button onclick="previousPage()">Previous</button>
          <span id="currentPage">1</span>
          <button onclick="nextPage()">Next</button>
        </div>
        <button onclick="showAddForm()">Add New Record</button>
        <div id="addForm" style="display: none">
          <h3>Add New Record</h3>
          <input type="text" id="usernameInput" placeholder="Username" />
          <input type="password" id="passwordInput" placeholder="Password" />
          <input
            type="date"
            id="creationDateInput"
            placeholder="Creation Date"
          />
          <input
            type="number"
            id="permissionLevelInput"
            placeholder="Permission Level"
          />
          <input type="text" id="accountTypeInput" placeholder="Account Type" />
          <input
            type="text"
            id="sessionTokenInput"
            placeholder="Session Token"
          />
          <button id="addButton" onclick="addRecord()">Add</button>
          <button onclick="cancelAdd()">Cancel</button>
        </div>
      </div>
      <div id="editForm" style="display: none">
        <h3>Edit Record</h3>
        <input type="text" id="editUsernameInput" placeholder="Username" />
        <input type="password" id="editPasswordInput" placeholder="Password" />
        <input
          type="date"
          id="editCreationDateInput"
          placeholder="Creation Date"
        />
        <input
          type="number"
          id="editPermissionLevelInput"
          placeholder="Permission Level"
        />
        <input
          type="text"
          id="editAccountTypeInput"
          placeholder="Account Type"
        />
        <input
          type="text"
          id="editSessionTokenInput"
          placeholder="Session Token"
        />
        <button id="updateButton">Update</button>
        <button onclick="cancelEdit()">Cancel</button>
      </div>
      <div id="content2" style="display: none">
        <h1>Action 2 Content</h1>
        <p>This is the content for Action 2.</p>
      </div>
      <div id="content3" style="display: none">
        <h1>Action 3 Content</h1>
        <p>This is the content for Action 3.</p>
      </div>
      <div id="content4" style="display: none">
        <h1>Action 4 Content</h1>
        <p>This is the content for Action 4.</p>
      </div>
    </div>
    <script>
      function showContent(contentId, button) {
        var contentAreas = document.getElementsByClassName("main")[0].children;
        for (var i = 0; i < contentAreas.length; i++) {
          contentAreas[i].style.display = "none";
        }
        document.getElementById(contentId).style.display = "block";
        var buttons = document.getElementsByTagName("a");
        for (var i = 0; i < buttons.length; i++) {
          if (buttons[i] == button) {
            buttons[i].classList.add("active");
          } else {
            buttons[i].classList.remove("active");
          }
        }
      }
      function logout() {
        fetch("/logout", {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Logged out successfully!");
              window.location.href = "/";
            }
          });
      }

      var database = [
        {
          accountId: 1,
          username: "John Doe",
          password: "password1",
          creationDate: "2020-01-01",
          permissionLevel: 1,
          accountType: "Admin",
          sessionToken: "token1",
        },
        {
          accountId: 2,
          username: "Jane Smith",
          password: "password2",
          creationDate: "2020-02-02",
          permissionLevel: 2,
          accountType: "User",
          sessionToken: "token2",
        },
        {
          accountId: 3,
          username: "Bob Johnson",
          password: "password3",
          creationDate: "2020-03-03",
          permissionLevel: 3,
          accountType: "User",
          sessionToken: "token3",
        },
      ];

      var currentPage = 1;
      var recordsPerPage = 10;

      function searchDatabase() {
        var searchInput = document.getElementById("searchInput");
        var searchTerm = searchInput.value.toLowerCase();

        var filteredDatabase = database.filter(function (record) {
          return (
            record.username.toLowerCase().includes(searchTerm) ||
            record.accountType.toLowerCase().includes(searchTerm) ||
            record.sessionToken.toLowerCase().includes(searchTerm)
          );
          // Add any other fields you want to search by
        });

        displayDatabase(filteredDatabase);
      }

      function displayDatabase(databaseToDisplay) {
        if (!databaseToDisplay) {
          databaseToDisplay = database;
        }

        var tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = "";

        var startIndex = (currentPage - 1) * recordsPerPage;
        var endIndex = startIndex + recordsPerPage;
        var currentRecords = databaseToDisplay.slice(startIndex, endIndex);

        for (var i = 0; i < currentRecords.length; i++) {
          var record = currentRecords[i];
          var cell = document.createElement("td");
          cell.textContent = record.username;
          var row = document.createElement("tr");
          cell.addEventListener("click", function() {
            var input = document.createElement("input");
            input.type = "text";
            input.value = this.textContent;
            this.textContent = "";
            this.appendChild(input);
            input.focus();
            input.addEventListener("blur", function() {
              this.parentNode.textContent = this.value;
              record.username = this.value;
              // You would also need to add code here to save the updated record to your database
            });
          }); // this currently only adds username, modify to do everything 
          row.appendChild(cell);
          
            // idk if this is needed rn 
          row.innerHTML = ` 
      <td>${record.accountId}</td> 
      <td>${record.username}</td> 
      <td>${record.password}</td> 
      <td>${record.creationDate}</td> 
      <td>${record.permissionLevel}</td> 
      <td>${record.accountType}</td> 
      <td>${record.sessionToken}</td> 
      <td> 
        <div class="w3-container">
          <button onclick="editRecord(${record.accountId})">Edit</button> 
          <p><button onclick="deleteRecord(${record.accountId})" class="w3-btn w3-orange w3-xlarge"><i class="w3-margin-left glyphicon glyphicon-trash"></i></button></p>
        </div>
      </td> 
    `;

          


          tableBody.appendChild(row);
        }

        updatePagination();
      }

      function updatePagination() {
        var currentPageElement = document.getElementById("currentPage");
        currentPageElement.textContent = currentPage;
      }

      function previousPage() {
        if (currentPage > 1) {
          currentPage--;
          displayDatabase();
        }
      }

      function nextPage() {
        var totalPages = Math.ceil(database.length / recordsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          displayDatabase();
        }
      }

      function addRecord() {
        var usernameInput = document.getElementById("usernameInput");
        var passwordInput = document.getElementById("passwordInput");
        // Add inputs for the new fields
        var creationDateInput = document.getElementById("creationDateInput");
        var permissionLevelInput = document.getElementById(
          "permissionLevelInput"
        );
        var accountTypeInput = document.getElementById("accountTypeInput");
        var sessionTokenInput = document.getElementById("sessionTokenInput");

        if (
          usernameInput.value === "" ||
          passwordInput.value === "" ||
          creationDateInput.value === "" ||
          permissionLevelInput.value === "" ||
          accountTypeInput.value === "" ||
          sessionTokenInput.value === ""
        ) {
          alert("Fill in all the fields!");
          return;
        }

        var newRecord = {
          accountId: database.length + 1, // Generate a new unique ID
          username: usernameInput.value,
          password: passwordInput.value,
          creationDate: creationDateInput.value,
          permissionLevel: permissionLevelInput.value,
          accountType: accountTypeInput.value,
          sessionToken: sessionTokenInput.value,
        };

        database.push(newRecord);
        usernameInput.value = "";
        passwordInput.value = "";
        creationDateInput.value = "";
        permissionLevelInput.value = "";
        accountTypeInput.value = "";
        sessionTokenInput.value = "";

        displayDatabase();
      }

      function showAddForm() {
        var addForm = document.getElementById("addForm");
        addForm.style.display = "";
      }

      function deleteRecord(accountId) {
        var index = database.findIndex(function (record) {
          return record.accountId === accountId;
        });

        if (index !== -1) {
          database.splice(index, 1);
          displayDatabase();
        }
      }

      function editRecord(accountId) {
        var record = database.find(function (record) {
          return record.accountId === accountId;
        });
        if (record) {
          var editUsernameInput = document.getElementById("editUsernameInput");
          var editPasswordInput = document.getElementById("editPasswordInput");
          var editCreationDateInput = document.getElementById(
            "editCreationDateInput"
          );
          var editPermissionLevelInput = document.getElementById(
            "editPermissionLevelInput"
          );
          var editAccountTypeInput = document.getElementById(
            "editAccountTypeInput"
          );
          var editSessionTokenInput = document.getElementById(
            "editSessionTokenInput"
          );

          editUsernameInput.value = record.username;
          editPasswordInput.value = record.password;
          editCreationDateInput.value = record.creationDate;
          editPermissionLevelInput.value = record.permissionLevel;
          editAccountTypeInput.value = record.accountType;
          editSessionTokenInput.value = record.sessionToken;

          var editForm = document.getElementById("editForm");
          editForm.style.display = "";

          var updateButton = document.getElementById("updateButton");
          updateButton.onclick = function () {
            console.log("yes");
            var editForm = document.getElementById("editForm");
            editForm.style.display = "none";
            updateRecord(accountId);
          };
        }
      }
      function cancelEdit() {
        var editForm = document.getElementById("editForm");
        editForm.style.display = "none";
      }
      function updateRecord(accountId) {
        var record = database.find(function (record) {
          return record.accountId === accountId;
        });

        if (record) {
          var usernameInput = document.getElementById("editUsernameInput");
          var passwordInput = document.getElementById("editPasswordInput");
          var creationDateInput = document.getElementById(
            "editCreationDateInput"
          );
          var permissionLevelInput = document.getElementById(
            "editPermissionLevelInput"
          );
          var accountTypeInput = document.getElementById(
            "editAccountTypeInput"
          );
          var sessionTokenInput = document.getElementById(
            "editSessionTokenInput"
          );
          console.log(usernameInput.value);
          record.username = usernameInput.value;
          record.password = passwordInput.value;
          record.creationDate = creationDateInput.value;
          record.permissionLevel = permissionLevelInput.value;
          record.accountType = accountTypeInput.value;
          record.sessionToken = sessionTokenInput.value;

          displayDatabase();

          // Reset the form and button
          usernameInput.value = "";
          passwordInput.value = "";
          creationDateInput.value = "";
          permissionLevelInput.value = "";
          accountTypeInput.value = "";
          sessionTokenInput.value = "";

          var addButton = document.getElementById("addButton");
          addButton.innerHTML = "Add";
          addButton.onclick = addRecord;
        }
      }

      function cancelAdd() {
        var usernameInput = document.getElementById("usernameInput");
        var passwordInput = document.getElementById("passwordInput");
        var creationDateInput = document.getElementById("creationDateInput");
        var permissionLevelInput = document.getElementById(
          "permissionLevelInput"
        );
        var accountTypeInput = document.getElementById("accountTypeInput");
        var sessionTokenInput = document.getElementById("sessionTokenInput");

        usernameInput.value = "";
        passwordInput.value = "";
        creationDateInput.value = "";
        permissionLevelInput.value = "";
        accountTypeInput.value = "";
        sessionTokenInput.value = "";

        var addButton = document.getElementById("addButton");
        addButton.innerHTML = "Add";
        addButton.onclick = addRecord;

        var addForm = document.getElementById("addForm");
        addForm.style.display = "none";
      }

      // Initial display of the database
      displayDatabase();
    </script>
  </body>
</html>
{% endblock %}
